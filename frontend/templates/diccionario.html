<!DOCTYPE html>
<html class="light" lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Traductor Señas - Diccionario</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&display=swap" rel="stylesheet"/>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#0bbf55",
            "background-light": "#f5f8f6",
            "background-dark": "#102216",
          },
          fontFamily: {
            "display": ["Lexend", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.5rem",
            "lg": "1rem",
            "xl": "1.5rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
    .card-compact .letter-card { height: 180px; }
    .letter-card { height: 240px; }
    .letter-overlay-large .letter-label { font-size: 2.25rem; }
    .fallback-message { font-size: 0.85rem; }
  </style>
  <script src="../js/custom-alert.js"></script>
  <script>(function(){if(localStorage.getItem('theme')==='dark'){document.documentElement.classList.add('dark');}})();</script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen">
  <!-- Header común -->
  <header class="w-full px-6 lg:px-20 py-6 flex flex-wrap gap-4 items-center justify-between bg-white/80 dark:bg-[#152a1c]/80 backdrop-blur border-b border-gray-200 dark:border-white/10">
    <div class="flex items-center gap-3">
      <div class="size-9 bg-primary/20 rounded-xl flex items-center justify-center text-primary">
        <span class="material-symbols-outlined">sign_language</span>
      </div>
      <div>
        <h1 class="text-xl font-bold tracking-tight">Traductor Señas</h1>
        <p class="text-xs text-gray-500 dark:text-gray-400">Diccionario LSM</p>
      </div>
    </div>
    <nav class="flex items-center flex-wrap gap-2 text-sm font-semibold text-gray-700 dark:text-gray-200">
      <button onclick="goHome()" class="px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/5">Inicio</button>
      <button onclick="goToDictionary()" class="px-3 py-2 rounded-lg bg-primary/10 text-primary font-bold">Diccionario</button>
      <button onclick="goToCapture()" class="px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/5">Captura</button>
      <button onclick="goToTranslator()" class="px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/5">Visualización</button>
    </nav>
    <div class="flex items-center gap-3 ml-auto">
      <button id="loginBtn" onclick="goToLoginPage()" class="hidden flex items-center gap-2 px-4 h-10 rounded-xl bg-white dark:bg-white/5 border border-gray-200 dark:border-gray-700 text-sm font-semibold hover:bg-gray-50 dark:hover:bg-white/10">
        <span class="material-symbols-outlined text-base">login</span>
        <span>Iniciar sesión</span>
      </button>
      <div id="userSection" class="hidden flex items-center gap-3">
        <span class="text-sm text-gray-600 dark:text-gray-300">Hola, <span id="userName" class="font-bold text-primary"></span></span>
        <button onclick="logout()" class="flex items-center gap-1 px-4 h-10 rounded-xl bg-red-500/10 text-red-600 dark:text-red-400 text-sm font-semibold hover:bg-red-500/20">
          <span class="material-symbols-outlined text-base">logout</span>
          <span>Cerrar sesión</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Intro -->
  <section class="px-6 lg:px-20 py-4">
    <div class="bg-white dark:bg-[#152a1c] border border-gray-200 dark:border-white/10 rounded-xl p-6 space-y-3">
      <div class="flex flex-wrap items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-bold">Cómo aprovechar el diccionario</h2>
          <p class="text-sm text-gray-700 dark:text-gray-300">Cada tarjeta muestra la configuración de mano para una letra del abecedario en Lengua de Señas Mexicana. Observa la forma, la orientación de la palma y la posición de los dedos; repite el gesto frente a la cámara para que el traductor lo reconozca.</p>
        </div>
        <div class="flex gap-2">
          <button id="helpBtn" class="px-3 py-2 rounded-lg bg-primary/10 text-primary flex items-center gap-1 hover:bg-primary/20">
            <span class="material-symbols-outlined text-base">help</span><span>Ayuda</span>
          </button>
          <button id="configBtn" class="px-3 py-2 rounded-lg bg-white dark:bg-white/5 border border-gray-200 dark:border-white/10 flex items-center gap-1 hover:bg-gray-50 dark:hover:bg-white/10">
            <span class="material-symbols-outlined text-base">settings</span><span>Configuración</span>
          </button>
        </div>
      </div>
      <p class="text-sm text-gray-700 dark:text-gray-300">Consejos rápidos: practica con luz frontal suave, mantén la mano dentro del encuadre y evita fondos muy oscuros o brillantes. Activa el modo compacto si quieres ver más letras en pantalla y usa etiquetas grandes si necesitas contraste adicional.</p>
      <p class="text-sm text-gray-700 dark:text-gray-300">Si estás enseñando, combina este material con ejercicios de deletreo, secuencias de palabras cortas y pausas breves para reforzar la memoria muscular.</p>
    </div>
  </section>

  <!-- Grid of Letters -->
  <main class="px-6 lg:px-20 py-6">
    <div id="gridWrapper" class="transition-all">
      <div id="lettersGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6"></div>
    </div>
  </main>

  <footer class="px-6 lg:px-20 pb-8 text-sm text-gray-600 dark:text-gray-400">
    © 2026 Trabajo de universidad UMB.
  </footer>

  <!-- Help Modal -->
  <div id="helpModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white dark:bg-[#152a1c] rounded-xl p-6 max-w-xl w-full mx-4 border border-gray-200 dark:border-white/10">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-bold">Ayuda</h3>
        <button class="material-symbols-outlined cursor-pointer" onclick="toggleHelp(false)">close</button>
      </div>
      <p class="text-sm text-gray-700 dark:text-gray-300 leading-relaxed">
        - Coloca tu mano frente a la cámara con buena iluminación.<br/>
        - Observa la forma de la mano para cada letra del abecedario LSM.<br/>
        - Practica manteniendo la posición estable durante 1–2 segundos.<br/>
        - Cambia a modo oscuro si te ayuda a la lectura.<br/>
        - Usa el modo compacto para ver más letras por pantalla.
      </p>
      <div class="mt-4 text-right">
        <button class="px-4 py-2 bg-primary text-background-dark font-bold rounded-lg hover:bg-opacity-90" onclick="toggleHelp(false)">Entendido</button>
      </div>
    </div>
  </div>

  <!-- Config Modal -->
  <div id="configModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white dark:bg-[#152a1c] rounded-xl p-6 max-w-xl w-full mx-4 border border-gray-200 dark:border-white/10">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold">Configuración</h3>
        <button class="material-symbols-outlined cursor-pointer" onclick="toggleConfig(false)">close</button>
      </div>
      <div class="space-y-4">
        <label class="flex items-center justify-between cursor-pointer">
          <span>Modo oscuro</span>
          <input id="darkModeToggle" type="checkbox" class="w-5 h-5 cursor-pointer" />
        </label>
        <label class="flex items-center justify-between cursor-pointer">
          <span>Tarjetas compactas</span>
          <input id="compactToggle" type="checkbox" class="w-5 h-5 cursor-pointer" />
        </label>
        <label class="flex items-center justify-between cursor-pointer">
          <span>Etiquetas grandes</span>
          <input id="overlayToggle" type="checkbox" class="w-5 h-5 cursor-pointer" />
        </label>
      </div>
      <div class="mt-6 flex justify-end gap-3">
        <button class="px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-lg" onclick="toggleConfig(false)">Cerrar</button>
        <button class="px-4 py-2 bg-primary text-background-dark font-bold rounded-lg hover:bg-opacity-90" onclick="applyConfig()">Aplicar</button>
      </div>
    </div>
  </div>

  <script>
    // Theme persistence
    (function applySavedTheme(){
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') document.documentElement.classList.add('dark');
    })();

    // Modals handlers
    const helpModal = document.getElementById('helpModal');
    const configModal = document.getElementById('configModal');
    document.getElementById('helpBtn').addEventListener('click', ()=> toggleHelp(true));
    document.getElementById('configBtn').addEventListener('click', ()=> toggleConfig(true));
    function toggleHelp(show){ helpModal.classList.toggle('hidden', !show); helpModal.classList.toggle('flex', show); }
    function toggleConfig(show){ configModal.classList.toggle('hidden', !show); configModal.classList.toggle('flex', show); }

    // Config toggles
    const darkToggle = document.getElementById('darkModeToggle');
    const compactToggle = document.getElementById('compactToggle');
    const overlayToggle = document.getElementById('overlayToggle');

    // Initialize from storage
    darkToggle.checked = document.documentElement.classList.contains('dark');
    compactToggle.checked = localStorage.getItem('cards') === 'compact';
    overlayToggle.checked = localStorage.getItem('labels') === 'large';

    function applyConfig() {
      darkToggle.dispatchEvent(new Event('change'));
      compactToggle.dispatchEvent(new Event('change'));
      overlayToggle.dispatchEvent(new Event('change'));
      showCustomAlert('Configuración aplicada', 'success');
      toggleConfig(false);
    }

    darkToggle.addEventListener('change', () => {
      document.documentElement.classList.toggle('dark', darkToggle.checked);
      localStorage.setItem('theme', darkToggle.checked ? 'dark' : 'light');
    });
    compactToggle.addEventListener('change', () => {
      document.getElementById('gridWrapper').classList.toggle('card-compact', compactToggle.checked);
      localStorage.setItem('cards', compactToggle.checked ? 'compact' : 'normal');
    });
    overlayToggle.addEventListener('change', () => {
      document.getElementById('lettersGrid').classList.toggle('letter-overlay-large', overlayToggle.checked);
      localStorage.setItem('labels', overlayToggle.checked ? 'large' : 'normal');
    });

    // Build letters grid
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
    const extensions = ['png','jpg','jpeg','webp'];

    function setLetterImage(img, letter, attemptIdx){
      const wrapper = img.parentElement;
      const nameVariants = [letter, letter.toLowerCase(), `Ejemplo-${letter}`, `Ejemplo-${letter.toLowerCase()}`];
      const candidates = [];
      nameVariants.forEach(name => extensions.forEach(ext => candidates.push(`/static/Letras/${name}.${ext}`)));

      if (attemptIdx >= candidates.length){
        img.classList.add('hidden');
        if (!wrapper.querySelector('.fallback-message')){
          const fallback = document.createElement('div');
          fallback.className = 'fallback-message absolute inset-0 flex items-center justify-center text-center text-gray-600 dark:text-gray-400 px-3';
          fallback.textContent = 'Imagen no disponible para esta letra';
          wrapper.appendChild(fallback);
        }
        wrapper.classList.add('image-fallback');
        return;
      }

      const url = candidates[attemptIdx];
      img.src = url;
      img.onerror = () => setLetterImage(img, letter, attemptIdx+1);
      img.onload = () => {
        img.classList.remove('hidden');
        const fallback = wrapper.querySelector('.fallback-message');
        if (fallback) fallback.remove();
        wrapper.classList.remove('image-fallback');
      };
    }

    const grid = document.getElementById('lettersGrid');
    letters.forEach(letter => {
      const card = document.createElement('div');
      card.className = 'letter-card bg-white dark:bg-[#152a1c] border border-gray-200 dark:border-white/10 rounded-xl overflow-hidden shadow-sm flex flex-col';

      const imgWrap = document.createElement('div');
      imgWrap.className = 'relative flex-1 min-h-[200px] flex items-center justify-center bg-black/5 dark:bg-white/5';
      const img = document.createElement('img');
      img.className = 'max-h-full max-w-full object-contain hidden';
      img.alt = `Letra ${letter}`;
      img.loading = 'lazy';
      img.decoding = 'async';
      setLetterImage(img, letter, 0);
      const label = document.createElement('div');
      label.className = 'letter-label absolute bottom-2 right-2 bg-primary text-background-dark font-bold rounded-lg px-3 py-1 shadow';
      label.textContent = letter;
      imgWrap.appendChild(img);
      imgWrap.appendChild(label);

      const caption = document.createElement('div');
      caption.className = 'px-4 py-3 text-sm text-gray-700 dark:text-gray-300';
      caption.textContent = `Letra ${letter} — Forma de mano en LSM. Fíjate en la orientación y en los dedos activos.`;

      card.appendChild(imgWrap);
      card.appendChild(caption);
      grid.appendChild(card);
    });

    // Apply stored UI prefs
    if (localStorage.getItem('cards') === 'compact') document.getElementById('gridWrapper').classList.add('card-compact');
    if (localStorage.getItem('labels') === 'large') document.getElementById('lettersGrid').classList.add('letter-overlay-large');

    // Auth display
    function checkAuth() {
      const userId = localStorage.getItem('userId');
      const userName = localStorage.getItem('userName');
      const loginBtn = document.getElementById('loginBtn');
      const userSection = document.getElementById('userSection');
      const nameSpan = document.getElementById('userName');

      if (userId && userName) {
        loginBtn.classList.add('hidden');
        userSection.classList.remove('hidden');
        nameSpan.textContent = userName;
      } else {
        loginBtn.classList.remove('hidden');
        userSection.classList.add('hidden');
      }
    }

    function goHome(){ window.location.href = 'index.html'; }
    function goToLoginPage(){ window.location.href = 'inicio-sesion.html'; }
    function goToDictionary(){ window.location.href = 'diccionario.html'; }
    function goToCapture(){
      const userId = localStorage.getItem('userId');
      if (!userId) {
        showCustomAlert('Inicia sesión para capturar gestos', 'warning');
        setTimeout(()=>window.location.href='inicio-sesion.html',1200);
        return;
      }
      window.location.href = `capture-images.html?userId=${userId}`;
    }
    function goToTranslator(){
      const userId = localStorage.getItem('userId');
      if (!userId) {
        showCustomAlert('Inicia sesión para usar el traductor', 'warning');
        setTimeout(()=>window.location.href='inicio-sesion.html',1200);
        return;
      }
      window.location.href = `visualize-model.html?userId=${userId}`;
    }
    function logout(){
      localStorage.removeItem('userId');
      localStorage.removeItem('userName');
      checkAuth();
      showCustomAlert('Sesión cerrada', 'success');
    }

    document.addEventListener('DOMContentLoaded', checkAuth);
  </script>
</body>
</html>
